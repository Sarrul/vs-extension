<!doctype html>
<html>
  <head>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: #0a0a0a;
        color: #e0e0e0;
        overflow: hidden;
      }

      .container {
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        background: #1a1a1a;
        padding: 16px 24px;
        border-bottom: 1px solid #333;
        z-index: 10;
      }

      .header h1 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 8px;
      }

      .stats {
        display: flex;
        gap: 24px;
        font-size: 12px;
        color: #888;
      }

      .stat span {
        color: #4ec9b0;
        font-weight: 600;
        margin-left: 4px;
      }

      .canvas-container {
        flex: 1;
        position: relative;
        overflow: auto;
        background: radial-gradient(circle at center, #1a1a1a 0%, #0a0a0a 100%);
      }

      .diagram {
        min-width: 100%;
        min-height: 100%;
        padding: 40px;
        display: flex;
        flex-direction: column;
        gap: 60px;
      }

      .layer {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }

      .layer-title {
        font-size: 14px;
        font-weight: 600;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 10px;
      }

      .layer-content {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        max-width: 1400px;
      }

      .file-card {
        background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
        border: 2px solid;
        border-radius: 12px;
        padding: 20px;
        min-width: 200px;
        max-width: 300px;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
      }

      .file-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      }

      .file-card.component {
        border-color: #3b82f6;
        background: linear-gradient(135deg, #1e2a3a 0%, #2a3a4a 100%);
      }

      .file-card.api {
        border-color: #10b981;
        background: linear-gradient(135deg, #1e3a2a 0%, #2a4a3a 100%);
      }

      .file-card.hook {
        border-color: #8b5cf6;
        background: linear-gradient(135deg, #2a1e3a 0%, #3a2a4a 100%);
      }

      .file-card.util {
        border-color: #f59e0b;
        background: linear-gradient(135deg, #3a2a1e 0%, #4a3a2a 100%);
      }

      .file-card.other {
        border-color: #6b7280;
        background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
      }

      .file-icon {
        font-size: 32px;
        margin-bottom: 8px;
      }

      .file-name {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #fff;
      }

      .file-stats {
        font-size: 11px;
        color: #888;
        margin-bottom: 12px;
      }

      .functions-list {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
      }

      .file-card.expanded .functions-list {
        max-height: 500px;
      }

      .function-item {
        padding: 8px 12px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 6px;
        margin-top: 8px;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .function-icon {
        font-size: 14px;
      }

      .expand-btn {
        position: absolute;
        top: 12px;
        right: 12px;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: #fff;
        width: 24px;
        height: 24px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .expand-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .connections {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
      }

      .legend {
        position: fixed;
        top: 80px;
        right: 20px;
        background: rgba(26, 26, 26, 0.95);
        border: 1px solid #333;
        border-radius: 8px;
        padding: 16px;
        font-size: 11px;
      }

      .legend-title {
        font-weight: 600;
        margin-bottom: 12px;
        color: #fff;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }

      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        border: 2px solid;
      }

      .zoom-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        gap: 8px;
        background: rgba(26, 26, 26, 0.95);
        border: 1px solid #333;
        border-radius: 8px;
        padding: 8px;
      }

      .zoom-btn {
        width: 36px;
        height: 36px;
        background: #2a2a2a;
        border: 1px solid #444;
        border-radius: 4px;
        color: #fff;
        cursor: pointer;
        font-size: 18px;
        transition: all 0.2s;
      }

      .zoom-btn:hover {
        background: #3a3a3a;
        border-color: #0e639c;
      }

      .empty-state {
        text-align: center;
        padding: 60px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üìê Project Architecture</h1>
        <div class="stats">
          <div class="stat">Files: <span id="fileCount">0</span></div>
          <div class="stat">Functions: <span id="functionCount">0</span></div>
          <div class="stat">Layers: <span id="layerCount">0</span></div>
        </div>
      </div>

      <div class="canvas-container" id="canvas">
        <div class="diagram" id="diagram"></div>
      </div>

      <div class="legend">
        <div class="legend-title">File Types</div>
        <div class="legend-item">
          <div
            class="legend-color"
            style="border-color: #3b82f6; background: rgba(59, 130, 246, 0.2)"
          ></div>
          <span>UI Components</span>
        </div>
        <div class="legend-item">
          <div
            class="legend-color"
            style="border-color: #10b981; background: rgba(16, 185, 129, 0.2)"
          ></div>
          <span>API / Routes</span>
        </div>
        <div class="legend-item">
          <div
            class="legend-color"
            style="border-color: #8b5cf6; background: rgba(139, 92, 246, 0.2)"
          ></div>
          <span>React Hooks</span>
        </div>
        <div class="legend-item">
          <div
            class="legend-color"
            style="border-color: #f59e0b; background: rgba(245, 158, 11, 0.2)"
          ></div>
          <span>Utilities</span>
        </div>
        <div class="legend-item">
          <div
            class="legend-color"
            style="border-color: #6b7280; background: rgba(107, 114, 128, 0.2)"
          ></div>
          <span>Other</span>
        </div>
      </div>

      <div class="zoom-controls">
        <button class="zoom-btn" id="zoomIn">+</button>
        <button class="zoom-btn" id="zoomOut">‚àí</button>
        <button class="zoom-btn" id="zoomReset">‚äô</button>
      </div>
    </div>

    <script>
      // Get data
      let roadmapData = window.ROADMAP_DATA || { files: [] };
      console.log("Roadmap data:", roadmapData);

      function getFileType(fileName) {
        const lower = fileName.toLowerCase();
        if (
          lower.includes("page") ||
          lower.includes("component") ||
          lower.endsWith(".tsx") ||
          lower.endsWith(".jsx")
        ) {
          return "component";
        }
        if (
          lower.includes("api") ||
          lower.includes("route") ||
          lower.includes("webhook")
        ) {
          return "api";
        }
        if (lower.startsWith("use") || lower.includes("hook")) {
          return "hook";
        }
        if (
          lower.includes("util") ||
          lower.includes("helper") ||
          lower.includes("lib")
        ) {
          return "util";
        }
        return "other";
      }

      function getFunctionIcon(name) {
        const lower = name.toLowerCase();
        if (lower.startsWith("use")) return "ü™ù";
        if (lower.startsWith("handle")) return "üéØ";
        if (lower.includes("fetch") || lower.includes("api")) return "üì°";
        if (lower.includes("render")) return "üé®";
        return "‚ö°";
      }

      function getFileIcon(type) {
        const icons = {
          component: "üé®",
          api: "üåê",
          hook: "ü™ù",
          util: "üîß",
          other: "üìÑ",
        };
        return icons[type] || "üìÑ";
      }

      // Organize files into layers
      function organizeIntoLayers(files) {
        const layers = {
          "UI Components": [],
          "API & Routes": [],
          "React Hooks": [],
          Utilities: [],
          Other: [],
        };

        files.forEach((file) => {
          const type = getFileType(file.name);

          if (type === "component") {
            layers["UI Components"].push(file);
          } else if (type === "api") {
            layers["API & Routes"].push(file);
          } else if (type === "hook") {
            layers["React Hooks"].push(file);
          } else if (type === "util") {
            layers["Utilities"].push(file);
          } else {
            layers["Other"].push(file);
          }
        });

        // Remove empty layers
        Object.keys(layers).forEach((key) => {
          if (layers[key].length === 0) {
            delete layers[key];
          }
        });

        return layers;
      }

      function renderDiagram(data) {
        const diagram = document.getElementById("diagram");
        diagram.innerHTML = "";

        if (!data || !data.files || data.files.length === 0) {
          diagram.innerHTML =
            '<div class="empty-state"><h3>No files found</h3><p>Make sure you have TypeScript files in your workspace</p></div>';
          return;
        }

        const layers = organizeIntoLayers(data.files);
        const layerNames = Object.keys(layers);

        // Update stats
        document.getElementById("fileCount").textContent = data.files.length;
        document.getElementById("functionCount").textContent =
          data.files.reduce((sum, f) => sum + f.functions.length, 0);
        document.getElementById("layerCount").textContent = layerNames.length;

        // Render each layer
        layerNames.forEach((layerName, layerIndex) => {
          const layerDiv = document.createElement("div");
          layerDiv.className = "layer";

          const title = document.createElement("div");
          title.className = "layer-title";
          title.textContent = layerName;
          layerDiv.appendChild(title);

          const content = document.createElement("div");
          content.className = "layer-content";

          layers[layerName].forEach((file) => {
            const type = getFileType(file.name);
            const card = document.createElement("div");
            card.className = `file-card ${type}`;

            const expandBtn = document.createElement("button");
            expandBtn.className = "expand-btn";
            expandBtn.textContent = "‚ñº";
            expandBtn.onclick = (e) => {
              e.stopPropagation();
              card.classList.toggle("expanded");
              expandBtn.textContent = card.classList.contains("expanded")
                ? "‚ñ≤"
                : "‚ñº";
            };

            card.innerHTML = `
              <div class="file-icon">${getFileIcon(type)}</div>
              <div class="file-name">${file.name}</div>
              <div class="file-stats">${file.functions.length} functions</div>
              <div class="functions-list">
                ${file.functions
                  .map(
                    (fn) => `
                  <div class="function-item">
                    <span class="function-icon">${getFunctionIcon(fn.name)}</span>
                    <span>${fn.name}</span>
                  </div>
                `,
                  )
                  .join("")}
              </div>
            `;

            card.insertBefore(expandBtn, card.firstChild);
            content.appendChild(card);
          });

          layerDiv.appendChild(content);
          diagram.appendChild(layerDiv);
        });
      }

      // Zoom controls
      let zoomLevel = 1;
      const canvas = document.getElementById("canvas");

      document.getElementById("zoomIn").onclick = () => {
        zoomLevel = Math.min(zoomLevel + 0.2, 2);
        document.getElementById("diagram").style.transform =
          `scale(${zoomLevel})`;
      };

      document.getElementById("zoomOut").onclick = () => {
        zoomLevel = Math.max(zoomLevel - 0.2, 0.5);
        document.getElementById("diagram").style.transform =
          `scale(${zoomLevel})`;
      };

      document.getElementById("zoomReset").onclick = () => {
        zoomLevel = 1;
        document.getElementById("diagram").style.transform = "scale(1)";
        canvas.scrollTop = 0;
        canvas.scrollLeft = 0;
      };

      // Mouse wheel zoom
      canvas.addEventListener("wheel", (e) => {
        if (e.ctrlKey) {
          e.preventDefault();
          if (e.deltaY < 0) {
            zoomLevel = Math.min(zoomLevel + 0.1, 2);
          } else {
            zoomLevel = Math.max(zoomLevel - 0.1, 0.5);
          }
          document.getElementById("diagram").style.transform =
            `scale(${zoomLevel})`;
        }
      });

      // Initialize
      renderDiagram(roadmapData);
    </script>
  </body>
</html>
